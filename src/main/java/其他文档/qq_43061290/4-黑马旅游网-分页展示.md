# 4-黑马旅游网-分页展示
## 旅游线路的分页展示

点击了不同的分类后，将来看到的旅游线路不一样的。通过分析数据库表结构，发现，旅游线路表和分类表时一个多对一的关系 <img src="https://img-blog.csdnimg.cn/20200319122305391.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMDYxMjkw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"/>

## 类别id的传递

Redis中查询score（cid）

```
package cn.itcast.travel.service.impl;

import cn.itcast.travel.dao.CategoryDao;
import cn.itcast.travel.dao.impl.CategoryDaoImpl;
import cn.itcast.travel.domain.Category;
import cn.itcast.travel.service.CategoryService;
import cn.itcast.travel.util.JedisUtil;
import redis.clients.jedis.Jedis;
import redis.clients.jedis.Tuple;

import java.util.ArrayList;
import java.util.List;
import java.util.Set;

public class CategoryServiceImpl implements CategoryService {<!-- -->

    private CategoryDao categoryDao = new CategoryDaoImpl();

    @Override
    public List<Category> findAll() {<!-- -->
        //1.从redis中查询
        //1.1获取jedis客户端
        Jedis jedis = JedisUtil.getJedis();
        //1.2可使用sortedset排序查询
        //Set<String> categorys = jedis.zrange("category", 0, -1);
        //1.3查询sortedset中的分数(cid)和值(cname)
        Set<Tuple> categorys = jedis.zrangeWithScores("category", 0, -1);

        List<Category> cs = null;
        //2.判断查询的集合是否为空
        if (categorys == null || categorys.size() == 0) {<!-- -->

            System.out.println("从数据库查询....");
            //3.如果为空,需要从数据库查询,在将数据存入redis
            //3.1 从数据库查询
            cs = categoryDao.findAll();
            //3.2 将集合数据存储到redis中的 category的key
            for (int i = 0; i < cs.size(); i++) {<!-- -->

                jedis.zadd("category", cs.get(i).getCid(), cs.get(i).getCname());
            }
        } else {<!-- -->
            System.out.println("从redis中查询.....");

            //4.如果不为空,将set的数据存入list
            cs = new ArrayList<Category>();
            for (Tuple tuple : categorys) {<!-- -->
                Category category = new Category();
                category.setCname(tuple.getElement());
                category.setCid((int)tuple.getScore());
                cs.add(category);

            }
        }


        return cs;
    }
}


```

页面传递cid header.html传递cid

```
var li = '- ['+data[i].cname+'](route_li st.html?cid='+data[i].cid+')';

```

```
<!-- 头部 start -->

<script src="js/getParameter.js"></script>
<script>
    $(function () {<!-- -->
        //查询用户信息
        $.get("user/findOne",{<!-- -->},function (data) {<!-- -->
           //{uid:1,name:'李四'}
           var msg = "欢迎回来，"+data.name;
           $("#span_username").html(msg);

       });

       //查询分类数据
        $.get("category/findAll",{<!-- -->},function (data) {<!-- -->
            //[{cid:1,cname:国内游},{},{}]
            var lis = '- [首页](index.html)';
            //遍历数组,拼接字符串(<li>)
            for (var i = 0; i < data.length; i++) {<!-- -->
                var li = '- ['+data[i].cname+'](route_list.html?cid='+data[i].cid+')';

                lis += li;
                
            }
            

            //拼接收藏排行榜的li,- [收藏排行榜](favoriterank.html)
            
            lis+= '- [收藏排行榜](favoriterank.html)';

            //将lis字符串，设置到ul的html内容中
            $("#category").html(lis);
        });


        //给搜索按钮绑定单击事件，获取搜索输入框的内容
        $("#search-button").click(function () {<!-- -->
            //线路名称
            var rname = $("#search_input").val();

            var cid = getParameter("cid");
            // 跳转路径 http://localhost/travel/route_list.html?cid=5，拼接上rname=xxx
            location.href="http://localhost/travel/route_list.html?cid="+cid+"&amp;rname="+rname;
        });
    });

</script>

<header id="header">
        
            <img src="images/top_banner.jpg" alt="">
        
        
            <!-- 未登录状态  -->
            
                [登录](login.html)
                [注册](register.html)
            
            <!-- 登录状态  -->
            
            	
                
                [我的收藏](myfavorite.html)
                [退出](javascript:location.href='exitServlet';)
            
        
        
            
                
                    [<img src="images/logo.jpg" alt="">](/)
                
                
                    <input name="" id="search_input"  type="text" placeholder="请输入路线名称" class="search_input" autocomplete="off">
                    [搜索](javascript:;)
                
                
                    
                        <img src="images/hot_tel.jpg" alt="">
                    
                    
                        <p class="hot_time">客服热线(9:00-6:00)</p>
                        <p class="hot_num">400-618-9090</p>
                    
                
            
        
    </header>
    <!-- 头部 end -->
     <!-- 首页导航 -->
    
        <ul id="category" class="nav">
           <!-- - [首页](index.html)
            - [门票](route_list.html)
            - [酒店](route_list.html)
            - [香港车票](route_list.html)
            - [出境游](route_list.html)
            - [国内游](route_list.html)
            - [港澳游](route_list.html)
            - [抱团定制](route_list.html)
            - [全球自由行](route_list.html)
            - [收藏排行榜](favoriterank.html)-->
        </ul>
    
    

```

## 获取cid

## route_list.html

```
$(function () {<!-- -->
   var search = location.search;
   //alert(search);//?id=5
    // 切割字符串，拿到第二个值
    var cid = search.split("=")[1];
});

```

## 根据id查询不同类别的旅游线路数据

分页展示旅游线路数据：

<img src="https://img-blog.csdnimg.cn/20200412165219503.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMDYxMjkw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"/>

## 后台代码编写

## 创建pagebean

```
package cn.itcast.travel.domain;

import java.util.List;

/**
 * 分页对象
 */
public class PageBean<T> {

    private int totalCount;//总记录数
    private int totalPage;//总页数
    private int currentPage;//当前页码
    private int pageSize;//每页显示的条数

    private List<T> list;//每页显示的数据集合

    public int getTotalCount() {
        return totalCount;
    }

    public void setTotalCount(int totalCount) {
        this.totalCount = totalCount;
    }

    public int getTotalPage() {
        return totalPage;
    }

    public void setTotalPage(int totalPage) {
        this.totalPage = totalPage;
    }

    public int getCurrentPage() {
        return currentPage;
    }

    public void setCurrentPage(int currentPage) {
        this.currentPage = currentPage;
    }

    public int getPageSize() {
        return pageSize;
    }

    public void setPageSize(int pageSize) {
        this.pageSize = pageSize;
    }

    public List<T> getList() {
        return list;
    }

    public void setList(List<T> list) {
        this.list = list;
    }
}


```

## RouteServlet

```
package cn.itcast.travel.web.servlet;

import cn.itcast.travel.domain.PageBean;
import cn.itcast.travel.domain.Route;
import cn.itcast.travel.service.RouteService;
import cn.itcast.travel.service.impl.RouteServiceImpl;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

@WebServlet("/route/*")
public class RouteServlet extends BaseServlet {<!-- -->

    private RouteService routeService = new RouteServiceImpl();

    /**
     * 分页查询
     * @param request
     * @param response
     * @throws ServletException
     * @throws IOException
     */
    public void pageQuery(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {<!-- -->
        //1.接受参数
        String currentPageStr = request.getParameter("currentPage");
        String pageSizeStr = request.getParameter("pageSize");
        String cidStr = request.getParameter("cid");

        int cid = 0;//类别id
        //2.处理参数
        if(cidStr != null &amp;&amp; cidStr.length() > 0){<!-- -->
            cid = Integer.parseInt(cidStr);
        }
        int currentPage = 0;//当前页码，如果不传递，则默认为第一页
        if(currentPageStr != null &amp;&amp; currentPageStr.length() > 0){<!-- -->
            currentPage = Integer.parseInt(currentPageStr);
        }else{<!-- -->
            currentPage = 1;
        }

        int pageSize = 0;//每页显示条数，如果不传递，默认每页显示5条记录
        if(pageSizeStr != null &amp;&amp; pageSizeStr.length() > 0){<!-- -->
            pageSize = Integer.parseInt(pageSizeStr);
        }else{<!-- -->
            pageSize = 5;
        }

        //3. 调用service查询PageBean对象
        PageBean<Route> pb = routeService.pageQuery(cid, currentPage, pageSize);

        //4. 将pageBean对象序列化为json，返回
        writeValue(pb,response);

    }

}


```

## RouteService

```
package cn.itcast.travel.service;

import cn.itcast.travel.domain.PageBean;
import cn.itcast.travel.domain.Route;

/**
 * 线路Service
 */
public interface RouteService {<!-- -->

    /**
     * 根据类别进行分页查询
     * @param cid
     * @param currentPage
     * @param pageSize
     * @return
     */
    public PageBean<Route> pageQuery(int cid,int currentPage,int pageSize);

}



```

## RouteServiceImpl

```
package cn.itcast.travel.service.impl;

import cn.itcast.travel.dao.RouteDao;
import cn.itcast.travel.dao.impl.RouteDaoImpl;
import cn.itcast.travel.domain.PageBean;
import cn.itcast.travel.domain.Route;
import cn.itcast.travel.service.RouteService;

import java.util.List;

public class RouteServiceImpl implements RouteService {<!-- -->
    private RouteDao routeDao = new RouteDaoImpl();
    @Override
    public PageBean<Route> pageQuery(int cid, int currentPage, int pageSize) {<!-- -->
        //封装PageBean
        PageBean<Route> pb = new PageBean<Route>();
        //设置当前页码
        pb.setCurrentPage(currentPage);
        //设置每页显示条数
        pb.setPageSize(pageSize);
        
        //设置总记录数
        int totalCount = routeDao.findTotalCount(cid);
        pb.setTotalCount(totalCount);
        //设置当前页显示的数据集合
        int start = (currentPage - 1) * pageSize;//开始的记录数
        List<Route> list = routeDao.findByPage(cid,start,pageSize);
        pb.setList(list);

        //设置总页数 = 总记录数/每页显示条数
        int totalPage = totalCount % pageSize == 0 ? totalCount / pageSize :(totalCount / pageSize) + 1 ;
        pb.setTotalPage(totalPage);


        return pb;
    }
}


```

## RouteDao

```
package cn.itcast.travel.dao;

import cn.itcast.travel.domain.Route;

import java.util.List;

public interface RouteDao {<!-- -->

    /**
     * 根据cid查询总记录数
     */
    public int findTotalCount(int cid);

    /**
     * 根据cid，start,pageSize查询当前页的数据集合
     */
    public List<Route> findByPage(int cid , int start , int pageSize);
}


```

```
package cn.itcast.travel.dao.impl;

import cn.itcast.travel.dao.RouteDao;
import cn.itcast.travel.domain.Route;
import cn.itcast.travel.util.JDBCUtils;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.JdbcTemplate;

import java.util.List;

public class RouteDaoImpl implements RouteDao {<!-- -->
    private JdbcTemplate template = new JdbcTemplate(JDBCUtils.getDataSource());

    @Override
    public int findTotalCount(int cid) {<!-- -->
        String sql = "select count(*) from tab_route where cid = ?";
        return template.queryForObject(sql,Integer.class,cid);
    }

    @Override
    public List<Route> findByPage(int cid, int start, int pageSize) {<!-- -->
        String sql = "select * from tab_route where cid = ? limit ? , ?";

        return template.query(sql,new BeanPropertyRowMapper<Route>(Route.class),cid,start,pageSize);
    }
}


```

## 前台代码

```
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>黑马旅游-搜索</title>
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" href="css/search.css">
    <script src="js/jquery-3.3.1.js"></script>

    <script>

        $(function () {<!-- -->
            var search = location.search;
            //alert(search);//?id=5
            // 切割字符串，拿到第二个值
            var cid = search.split("=")[1];

            //当页码加载完成后，调用load方法，发送ajax请求加载数据
            load(cid);
        });

        function load(cid ,currentPage){<!-- -->
            //发送ajax请求，请求route/pageQuery,传递cid
            $.get("route/pageQuery",{<!-- -->cid:cid,currentPage:currentPage},function (pb) {<!-- -->
                //解析pagebean数据，展示到页面上

                //1.分页工具条数据展示
                //1.1 展示总页码和总记录数
                $("#totalPage").html(pb.totalPage);
                $("#totalCount").html(pb.totalCount);

                /*
                        - [首页]()
                        - [上一页](#)
                        - [1](#)
                        - [2](#)
                        - [3](#)
                        - [4](#)
                        - [5](#)
                        - [6](#)
                        - [7](#)
                        - [8](#)
                        - [9](#)
                        - [10](#)
                        - [下一页](javascript:;)
                        - [末页](javascript:;)


                 */
                var lis = "";

                var fristPage = '- [首页](javascript:void(0))';

                //计算上一页的页码
                var beforeNum =  pb.currentPage - 1;
                if(beforeNum <= 0){<!-- -->
                    beforeNum = 1;
                }

                var beforePage = '- [上一页](javascript:void(0))';

                lis += fristPage;
                lis += beforePage;
                //1.2 展示分页页码
                /*
                    1.一共展示10个页码，能够达到前5后4的效果
                    2.如果前边不够5个，后边补齐10个
                    3.如果后边不足4个，前边补齐10个
                */

                // 定义开始位置begin,结束位置 end
                var begin; // 开始位置
                var end ; //  结束位置


                //1.要显示10个页码
                if(pb.totalPage < 10){<!-- -->
                    //总页码不够10页

                    begin = 1;
                    end = pb.totalPage;
                }else{<!-- -->
                    //总页码超过10页

                    begin = pb.currentPage - 5 ;
                    end = pb.currentPage + 4 ;

                    //2.如果前边不够5个，后边补齐10个
                    if(begin < 1){<!-- -->
                        begin = 1;
                        end = begin + 9;
                    }

                    //3.如果后边不足4个，前边补齐10个
                    if(end > pb.totalPage){<!-- -->
                        end = pb.totalPage;
                        begin = end - 9 ;
                    }
                }


                for (var i = begin; i <= end ; i++) {<!-- -->
                    var li;
                    //判断当前页码是否等于i
                    if(pb.currentPage == i){<!-- -->

                        li = '- ['+i+'](javascript:void(0))';

                    }else{<!-- -->
                        //创建页码的li
                        li = '- ['+i+'](javascript:void(0))';
                    }
                    //拼接字符串
                    lis += li;
                }





               /* for (var i = 1; i <= pb.totalPage ; i++) {
                    var li;
                    //判断当前页码是否等于i
                    if(pb.currentPage == i){

                        li = '- ['+i+'](javascript:void(0))';

                    }else{
                        //创建页码的li
                        li = '- ['+i+'](javascript:void(0))';
                    }
                    //拼接字符串
                    lis += li;
                }*/
                var lastPage = '- [末页](javascript:;)';
                var nextPage = '- [下一页](javascript:;)';

                lis += nextPage;
                lis += lastPage;


                //将lis内容设置到 ul
                $("#pageNum").html(lis);



                /*
                    <li>
                        <img src="images/04-search_03.jpg" alt="">
                        
                            【减100元 含除夕/春节出发】广州增城三英温泉度假酒店/自由行套票
                            <br/>
                            1-2月出发，网付立享￥1099/2人起！爆款位置有限，抢完即止！
                        
                        
                            <p class="price_num">
                                &amp;yen;
                                299
                                起
                            </p>
                            [查看详情](route_detail.html)
                        
                    </li>

                 */

                //2.列表数据展示
                var route_lis = "";

                for (var i = 0; i < pb.list.length; i++) {<!-- -->
                    //获取{rid:1,rname:"xxx"}
                    var route = pb.list[i];

                    var li = '<li>\n' +
                        '                        <img src="'+route.rimage+'" style="width: 299px;">\n' +
                        '                        \n' +
                        '                            '+route.rname+'\n' +
                        '                            <br/>\n' +
                        '                            '+route.routeIntroduce+'\n' +
                        '                        \n' +
                        '                        \n' +
                        '                            <p class="price_num">\n' +
                        '                                &amp;yen;\n' +
                        '                                '+route.price+'\n' +
                        '                                起\n' +
                        '                            </p>\n' +
                        '                            [查看详情](route_detail.html)\n' +
                        '                        \n' +
                        '                    </li>';
                    route_lis += li;
                }
                $("#route").html(route_lis);

                //定位到页面顶部
                window.scrollTo(0,0);
            });

        }


    </script>
</head>
<body>
<!--引入头部-->


    
        
            <img src="images/search.png" alt="">
            <p>黑马旅行>搜索结果</p>
        
        
            
                
                    商品信息
                    价格
                
                <ul id="route">
                    <li>
                        <img src="images/04-search_03.jpg" alt="">
                        
                            <p>【减100元 含除夕/春节出发】广州增城三英温泉度假酒店/自由行套票</p>
                            <br/>
                            <p>1-2月出发，网付立享￥1099/2人起！爆款位置有限，抢完即止！</p>
                        
                        
                            <p class="price_num">
                                &amp;yen;
                                299
                                起
                            </p>
                            <p>[查看详情](route_detail.html)</p>
                        
                    </li>
                    <li>
                        <img src="images/04-search_03.jpg" alt="">
                        
                            <p>浪花朵朵旅行普吉岛丛林飞跃空中飞人探险游中文服务泰国旅游</p>
                            <br/>
                            <p>1-2月出发，网付立享￥1099/2人起！爆款位置有限，抢完即止！</p>
                        
                        
                            <p class="price_num">
                                &amp;yen;
                                899
                                起
                            </p>
                            <p>[查看详情](route_detail.html)</p>
                        
                    </li>
                    <li>
                        <img src="images/04-search_03.jpg" alt="">
                        
                            <p>黑妞皇家旅行普吉岛攀牙湾大船星光之旅皮划艇日落休闲特色体验</p>
                            <br/>
                            <p>1-2月出发，网付立享￥1099/2人起！爆款位置有限，抢完即止！</p>
                        
                        
                            <p class="price_num">
                                &amp;yen;
                                999
                                起
                            </p>
                            <p>[查看详情](route_detail.html)</p>
                        
                    </li>
                    <li>
                        <img src="images/04-search_03.jpg" alt="">
                        
                            <p>浪花朵朵旅行普吉岛皇帝岛珊瑚岛香蕉船拖拽伞水上项目</p>
                            <br/>
                            <p>1-2月出发，网付立享￥1099/2人起！爆款位置有限，抢完即止！</p>
                        
                        
                            <p class="price_num">
                                &amp;yen;
                                99
                                起
                            </p>
                            <p>[查看详情](route_detail.html)</p>
                        
                    </li>
                    <li>
                        <img src="images/04-search_03.jpg" alt="">
                        
                            <p>环游记 泰国清迈Lila massage女子监狱spa 丽菈泰式按摩马杀鸡</p>
                            <br/>
                            <p>1-2月出发，网付立享￥1099/2人起！爆款位置有限，抢完即止！</p>
                        
                        
                            <p class="price_num">
                                &amp;yen;
                                199
                                起
                            </p>
                            <p>[查看详情](route_detail.html)</p>
                        
                    </li>
                    <li>
                        <img src="images/04-search_03.jpg" alt="">
                        
                            <p>【减100元 含除夕/春节出发】广州增城三英温泉度假酒店/自由行套票</p>
                            <br/>
                            <p>1-2月出发，网付立享￥1099/2人起！爆款位置有限，抢完即止！</p>
                        
                        
                            <p class="price_num">
                                &amp;yen;
                                899
                                起
                            </p>
                            <p>[查看详情](route_detail.html)</p>
                        
                    </li>
                    <li>
                        <img src="images/04-search_03.jpg" alt="">
                        
                            <p>【减100元 含除夕/春节出发】广州增城三英温泉度假酒店/自由行套票</p>
                            <br/>
                            <p>1-2月出发，网付立享￥1099/2人起！爆款位置有限，抢完即止！</p>
                        
                        
                            <p class="price_num">
                                &amp;yen;
                                1199
                                起
                            </p>
                            <p>[查看详情](route_detail.html)</p>
                        
                    </li>
                    <li>
                        <img src="images/04-search_03.jpg" alt="">
                        
                            <p>泰国芭提雅三合一日游芭提雅蒂芬妮人妖秀成人门票bigeye含接送</p>
                            <br/>
                            <p>1-2月出发，网付立享￥1099/2人起！爆款位置有限，抢完即止！</p>
                        
                        
                            <p class="price_num">
                                &amp;yen;
                                1589
                                起
                            </p>
                            <p>[查看详情](route_detail.html)</p>
                        
                    </li>
                </ul>
                
                    <i></i> 共
                    12页132条
                
                
                    <ul id="pageNum">
                        - [首页]()
                        - [上一页](#)
                        - [1](#)
                        - [2](#)
                        - [3](#)
                        - [4](#)
                        - [5](#)
                        - [6](#)
                        - [7](#)
                        - [8](#)
                        - [9](#)
                        - [10](#)
                        - [下一页](javascript:;)
                        - [末页](javascript:;)
                    </ul>
                
            
            
                
                    HOT
                    热门推荐
                
                <ul>
                    <li>
                        <img src="images/04-search_09.jpg" alt="">
                        
                            <p>清远新银盏温泉度假村酒店/自由行套...</p>
                            <p>网付价&amp;yen;899起
                            </p>
                        
                    </li>
                    <li>
                        <img src="images/04-search_09.jpg" alt="">
                        
                            <p>清远新银盏温泉度假村酒店/自由行套...</p>
                            <p>网付价&amp;yen;899起
                            </p>
                        
                    </li>
                    <li>
                        <img src="images/04-search_09.jpg" alt="">
                        
                            <p>清远新银盏温泉度假村酒店/自由行套...</p>
                            <p>网付价&amp;yen;899起
                            </p>
                        
                    </li>
                    <li>
                        <img src="images/04-search_09.jpg" alt="">
                        
                            <p>清远新银盏温泉度假村酒店/自由行套...</p>
                            <p>网付价&amp;yen;899起
                            </p>
                        
                    </li>
                    <li>
                        <img src="images/04-search_09.jpg" alt="">
                        
                            <p>清远新银盏温泉度假村酒店/自由行套...</p>
                            <p>网付价&amp;yen;899起
                            </p>
                        
                    </li>
                </ul>
            
        
    


<!--引入头部-->

<!--导入布局js，共享header和footer-->
<script type="text/javascript" src="js/include.js"></script>
</body>

</html>

```
# **文章地址： **https://blog.csdn.net/qq_43061290/article/details/104964702