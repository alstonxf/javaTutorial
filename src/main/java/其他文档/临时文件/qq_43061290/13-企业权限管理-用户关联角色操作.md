# 13-企业权限管理-用户关联角色操作
## 用户关联角色操作

<img src="https://img-blog.csdnimg.cn/20200419175836315.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMDYxMjkw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"/> 从前台发送请求

```
[添加角色](${pageContext.request.contextPath}/user/findUserByIdAndAllRole.do?id=${user.id})


```

## 查询用户以及用户可以添加的角色

## usercontroller

```
    //查询用户以及用户可以添加的角色
    @RequestMapping("/findUserByIdAndAllRole.do")
    public ModelAndView findUserByIdAndAllRole(@RequestParam(name = "id", required = true) String userid) throws Exception {<!-- -->
        ModelAndView mv = new ModelAndView();
        //1.根据用户id查询用户
        UserInfo userInfo = userService.findById(userid);
        //2.根据用户id查询可以添加的角色
        List<Role> otherRoles = userService.findOtherRoles(userid);
        mv.addObject("user", userInfo);
        mv.addObject("roleList", otherRoles);
        mv.setViewName("user-role-add");
        return mv;
    }

```

## UserServiceImpl

```
  @Override
    public UserInfo findById(String id) throws Exception {<!-- -->
        return userDao.findById(id);
    }
    
    @Override
    public List<Role> findOtherRoles(String userid) throws Exception {<!-- -->
        return userDao.findOtherRoles(userid);
    }

```

## IUserDao

```
    @Select("select * from users where id=#{id}")
    @Results({<!-- -->
            @Result(id = true, property = "id", column = "id"),
            @Result(property = "username", column = "username"),
            @Result(property = "email", column = "email"),
            @Result(property = "password", column = "password"),
            @Result(property = "phoneNum", column = "phoneNum"),
            @Result(property = "status", column = "status"),
            @Result(property = "roles",column = "id",javaType = java.util.List.class,many = @Many(select = "com.itheima.ssm.dao.IRoleDao.findRoleByUserId"))
    })
    UserInfo findById(String id) throws Exception;

    @Select("select * from role where id not in (select roleId from users_role where userId=#{userId})")
    List<Role> findOtherRoles(String userId) throws Exception;
    //@Param 有两个int参数mybaties不知道怎末匹配
    @Insert("insert into users_role(userId,roleId) values(#{userId},#{roleId})")

```

## 给用户添加角色

## usercontroller

```
//给用户添加角色
    @RequestMapping("/addRoleToUser.do")
    public String addRoleToUser(@RequestParam(name = "userId", required = true) String userId, @RequestParam(name = "ids", required = true) String[] roleIds) throws Exception{<!-- -->
        userService.addRoleToUser(userId, roleIds);
        return "redirect:findAll.do";
    }

```

## UserServiceImpl

```
    @Override
    public void addRoleToUser(String userId, String[] roleIds) throws Exception {<!-- -->

        for(String roleId:roleIds){<!-- -->
            userDao.addRoleToUser(userId,roleId);
        }
    }

```

## IUserDao

```
 //@Param 有两个int参数mybaties不知道怎末匹配
    @Insert("insert into users_role(userId,roleId) values(#{userId},#{roleId})")
    void addRoleToUser(@Param("userId") String userId,@Param("roleId") String roleId) throws Exception;
}

```
# **文章地址： **https://blog.csdn.net/qq_43061290/article/details/105617840