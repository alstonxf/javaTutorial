# 2-黑马旅游网登陆-退出
## 登录

分析 <img src="https://img-blog.csdnimg.cn/20200316215310703.png" alt="在这里插入图片描述"/>

## 代码实现

## 前台代码

```
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>黑马旅游网-登录</title>  
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/login.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
      <!--导入angularJS文件-->
    <!--<script src="js/angular.min.js"></script>-->
	<!--导入jquery-->
	<script src="js/jquery-3.3.1.js"></script>

	<script>

		$(function () {<!-- -->
            //1.给登录按钮绑定单击事件
			$("#btn_sub").click(function () {<!-- -->
                //2.发送ajax请求，提交表单数据
				$.post("user/login",$("#loginForm").serialize(),function (data) {<!-- -->
					//data : {flag:false,errorMsg:''}
					if(data.flag){<!-- -->
					    //登录成功
						location.href="index.html";
					}else{<!-- -->
					    //登录失败
						$("#errorMsg").html(data.errorMsg);
					}
                });
            });
        });


		//3.处理响应结果



	</script>
</head>

<body>
<!--引入头部-->

    <!-- 头部 end -->
    <section id="login_wrap">
        
        	
        
        
        	
        		<img src="images/login_logo.png" alt="">
        		欢迎登录黑马旅游账户
        	
        	
				
				<!--登录错误提示消息-->
        		
				<form id="loginForm" action="" method="post" accept-charset="utf-8">
        			<input type="hidden" name="action" value="login"/>
					<input name="username" type="text" placeholder="请输入账号" autocomplete="off">
        			<input name="password" type="text" placeholder="请输入密码" autocomplete="off">
        			
					<input name="check" type="text" placeholder="请输入验证码" autocomplete="off">
					<img src="checkCode" alt="" onclick="changeCheckCode(this)">
					<script type="text/javascript">
						//图片点击事件
						function changeCheckCode(img) {<!-- -->
							img.src="checkCode?"+new Date().getTime();
						}
					</script>
			
			
        				<button type="button"  id="btn_sub">登录</button>
        				
        					<input type="checkbox" name="" class="checkbox">
        					自动登录
        				        				
        			        			       		
        		</form>
        		没有账户？[立即注册](javascript:;)
        	
        
    </section>
    <!--引入尾部-->
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-1.11.0.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <!--导入布局js，共享header和footer-->
    <script type="text/javascript" src="js/include.js"></script>
</body>

</html>

```

<img src="https://img-blog.csdnimg.cn/20200316215412434.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMDYxMjkw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"/>

## 后台代码

## LoginServlet

```
//1.获取用户名和密码数据
Map<String, String[]> map = request.getParameterMap();
//2.封装User对象
User user = new User();
try {<!-- -->
    BeanUtils.populate(user,map);
} catch (IllegalAccessException e) {<!-- -->
    e.printStackTrace();
} catch (InvocationTargetException e) {<!-- -->
    e.printStackTrace();
}

//3.调用Service查询
UserService service = new UserServiceImpl();
User u  = service.login(user);

ResultInfo info = new ResultInfo();

//4.判断用户对象是否为null
if(u == null){<!-- -->
    //用户名密码或错误
    info.setFlag(false);
    info.setErrorMsg("用户名密码或错误");
}
//5.判断用户是否激活
if(u != null &amp;&amp; !"Y".equals(u.getStatus())){<!-- -->
    //用户尚未激活
    info.setFlag(false);
    info.setErrorMsg("您尚未激活，请激活");
}
//6.判断登录成功
if(u != null &amp;&amp; "Y".equals(u.getStatus())){<!-- -->
    //登录成功
    info.setFlag(true);
}

//响应数据
ObjectMapper mapper = new ObjectMapper();

response.setContentType("application/json;charset=utf-8");
mapper.writeValue(response.getOutputStream(),info);

```

## UserService

```
public User login(User user) {<!-- -->
    return userDao.findByUsernameAndPassword(user.getUsername(),user.getPassword());
}

```

## UserDao

```
public User findByUsernameAndPassword(String username, String password) {<!-- -->
    User user = null;
    try {<!-- -->
        //1.定义sql
        String sql = "select * from tab_user where username = ? and password = ?";
        //2.执行sql
        user = template.queryForObject(sql, new BeanPropertyRowMapper<User>(User.class), username,password);
    } catch (Exception e) {<!-- -->

    }

    return user;
}

```

## index页面中用户姓名的提示信息功能

## 前端代码

```
<!-- 头部 start -->
<script>
    $(function () {<!-- -->
        //查询用户信息
        $.get("user/findOne",{<!-- -->},function (data) {<!-- -->
           //{uid:1,name:'李四'}
           var msg = "欢迎回来，"+data.name;
           $("#span_username").html(msg);

       });

      
</script>

<header id="header">
        
            <img src="images/top_banner.jpg" alt="">
        
        
            <!-- 未登录状态  -->
            
                [登录](login.html)
                [注册](register.html)
            
            <!-- 登录状态  -->
            
            	
                
                [我的收藏](myfavorite.html)
                [退出](javascript:location.href='exitServlet';)
            
        
        
            
                
                    [<img src="images/logo.jpg" alt="">](/)
                
                
                    <input name="" type="text" placeholder="请输入路线名称" class="search_input" autocomplete="off">
                    [搜索](javascript:;)
                
                
                    
                        <img src="images/hot_tel.jpg" alt="">
                    
                    
                        <p class="hot_time">客服热线(9:00-6:00)</p>
                        <p class="hot_num">400-618-9090</p>
                    
                
            
        
    </header>
    <!-- 头部 end -->
     <!-- 首页导航 -->
    
        <ul id="category" class="nav">
           <!-- - [首页](index.html)
            - [门票](route_list.html)
            - [酒店](route_list.html)
            - [香港车票](route_list.html)
            - [出境游](route_list.html)
            - [国内游](route_list.html)
            - [港澳游](route_list.html)
            - [抱团定制](route_list.html)
            - [全球自由行](route_list.html)
            - [收藏排行榜](favoriterank.html)-->
        </ul>
    
    

```

## header.html

<img src="https://img-blog.csdnimg.cn/20200317120116894.png" alt="在这里插入图片描述"/>

## Servlet代码

## FindUserServlet

```
package cn.itcast.travel.web.servlet;

import com.fasterxml.jackson.databind.ObjectMapper;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

@WebServlet("/findUserServlet")
public class FindUserServlet extends HttpServlet {<!-- -->
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {<!-- -->
        //从session中获取登录用户
        Object user = request.getSession().getAttribute("user");
        //将user写回客户端

        ObjectMapper mapper = new ObjectMapper();
        response.setContentType("application/json;charset=utf-8");
        mapper.writeValue(response.getOutputStream(),user);


    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {<!-- -->
        this.doPost(request, response);
    }
}


```

## 退出

## 什么叫做登录了？session中有user对象。

实现步骤： 1.访问servlet，将session销毁 2.跳转到登录页面

## Header.html

<img src="https://img-blog.csdnimg.cn/20200317142157345.png" alt="在这里插入图片描述"/>

## Servlet:

```
package cn.itcast.travel.web.servlet;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

@WebServlet("/exitServlet")
public class ExitServlet extends HttpServlet {<!-- -->
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {<!-- -->
        //1.销毁session
        request.getSession().invalidate();

        //2.跳转登录页面
        response.sendRedirect(request.getContextPath()+"/login.html");
    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {<!-- -->
        this.doPost(request, response);
    }
}


```
# **文章地址： **https://blog.csdn.net/qq_43061290/article/details/104909389